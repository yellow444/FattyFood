jQuery(function($){function alert_error(e){""==e&&(e="unknown error."),e.length>500&&(e=e.slice(0,500)+"..."),alert("Error: "+e)}function ajax_report(e){$(e+" .ajax_report.message_success").ajaxStart(function(){ajax_session==e&&(clearTimeout(ajax_report_timeout),$(this).addClass("loading"),$(e+" .ajax_report.message_success span").hide(),$(e+" .ajax_report.message_success").show(),$(e+" input").prop("disabled",!0),$(e+" textarea").prop("disabled",!0))}),$(e+" .ajax_report.message_success").ajaxComplete(function(){ajax_session==e&&($(this).removeClass("loading"),$(e+" input").prop("disabled",!1),$(e+" textarea").prop("disabled",!1),ajax_session=!1)})}function ajax_message_error(e,t){"undefined"!=typeof t&&($(e+" .ajax_report.message").hide(),$(e+" .ajax_report.message_error span").text(t)),$(e+" .ajax_report.message_error").show(),ajax_report_timeout=setTimeout(function(){$(e+" .ajax_report.message_error").hide()},4e3)}function ajax_message_success(e,t){"undefined"!=typeof t&&$(e+" .ajax_report.message_success span").text(t),$(e+" .ajax_report.message_success").show(),$(e+" .ajax_report.message_success span").show(),ajax_report_timeout=setTimeout(function(){$(e+" .ajax_report.message_success").hide()},3e3)}function rate_over(e){if(!rate_c){var t=e.data.id.replace(/[^\d]+/,"");rate_i=0,$("#image_rate img").each(function(){t>=rate_i?$(this).attr("src",$(this).attr("src").replace(/empty/,"full")):$(this).attr("src",$(this).attr("src").replace(/full/,"empty")),rate_i++})}}function rate_out(e){rate_c||(rate_i=0,$("#image_rate img").each(function(){$(this).attr("src",rate_init[rate_i]),rate_i++}))}function rate_click(e){rate_c=1,rate_i=0;var t=parseInt(e.data.id.replace(/[^\d]+/,""))+1,a=[];$("#image_rate img").each(function(){a[rate_i]=$(this).attr("src"),rate_i++}),$.post(gallery_path+"/ajax.php",{section:"rate",rate:t,id:img_id,q:q,q_md5:q_md5},function(e){if(null!=e){switch(e.status){case"success":$("#image_stats #rate").html(image_stat_rate.replace(/%1\$s/,e.rate_visual).replace(/%2\$s/,e.rate).replace(/%3\$s/,e.votes)),rate_init=a,-1!=q.search("/votes/")&&location.reload();break;case"error":alert_error(e.msg)}rate_c=0}},"json")}var addEvent=function(e,t,a){e.addEventListener?e.addEventListener(t,a,!1):e.attachEvent&&e.attachEvent("on"+t,a)},ajax_session=!1,ajax_report_timeout;if($(".focus").focus(),"undefined"!=typeof field_error&&$(".box #f_"+field_error).parent().addClass("field_error"),$("#deconnect_user_link").click(function(){$("#deconnect_user_input").click()}),$("#deconnect_object_link").click(function(){$("#deconnect_object_input").click()}),$("a[data-show].show_parts").click(function(){var e="#"+$(this).attr("data-show");$(e).is(":hidden")?($(e).show(),$(e+" .show_parts_focus").focus()):$(e).hide()}),$('input[type="checkbox"].show_part').each(function(){$(this).prop("checked")?$("#"+$(this).attr("data-show")).show():$("#"+$(this).attr("data-show")).hide()}),$('input[type="checkbox"].show_part').change(function(){$(this).prop("checked")?$("#"+$(this).attr("data-show")).show():$("#"+$(this).attr("data-show")).hide()}),$("#birthdate_reset").click(function(){$(".date_title").prop("selected",!0)}),$(".sorter").is("table")&&$("table.sorter").tablesorter({sortInitialOrder:"desc",sortList:[[0,0]]}),$("#lang_change").is("img")){var timeout_lang_list;$("#lang_change, #lang_list span").click(function(){$("#lang_list div").is(":hidden")?$("#lang_list div").fadeIn("fast"):$("#lang_list div").fadeOut("fast")}),$("#lang_change, #lang_list").bind("mouseleave",function(){timeout_lang_list=setTimeout(function(){$("#lang_list div").fadeOut("fast")},500)}).bind("mouseenter",function(){clearTimeout(timeout_lang_list)}),$("#lang_list li").click(function(){$("#new_lang").val($(this).find("a").attr("data-lang-code")),$("#change_lang").click()})}if($("#smilies").is("span")&&$("#smilies img").click(function(){var e,t,a,i=" "+$(this).attr("alt")+" ";textarea=document.getElementById("message"),textarea.focus(),"undefined"!=typeof document.selection?(document.selection.createRange().text=i,textarea.caretPos+=i.length):"undefined"!=typeof textarea.setSelectionRange&&(e=textarea.selectionStart,t=textarea.selectionEnd,a=textarea.scrollTop,textarea.value=textarea.value.substring(0,e)+i+textarea.value.substring(t),textarea.setSelectionRange(e+i.length,e+i.length),textarea.scrollTop=a)}),$("#tool_diaporama").is("li")){var diaporama=new Diaporama;$("#tool_diaporama").click(function(){$("#obj_tool_menu").hide(),$("#obj_tools_link a").removeClass("tool_menu_open"),diaporama.start(diaporama_query)})}if($("#comment_edit").is("div")){var id,edit_box_center=function(){$("#comment_edit_background").css({height:$(window).height()+"px",left:"0",position:"fixed",top:"0",width:$(window).width()+"px",zIndex:"99"}),$("#comment_edit").css({left:($(window).width()-$("#comment_edit").outerWidth())/2+"px",top:($(window).height()-$("#comment_edit").outerHeight())/2*.8+"px"})};$(window).resize(function(){edit_box_center()}),$(document).keyup(function(e){27==e.keyCode&&$("#comment_edit .cancel").trigger("click")}),$(".comment_edit").click(function(){com_id=$(this).parents(".comment").attr("id").replace("co","");var e=$("#co"+com_id+" .comment_message");e.after('<p style="display:none" id="comment_message_original"></p>'),$("#comment_message_original").html(e.html().replace(/<img alt="([^"]+)"[^>]+>/g,"$1").replace(/<a href="([^"]+)">[^<]+<\/a>/g,"$1"));var t=$("#comment_message_original").text();$("#comment_message_original").remove(),$("#comment_edit_background").show(),edit_box_center(),$("#comment_edit textarea").val(t),$("#comment_edit textarea").focus()}),$("#comment_edit .cancel").click(function(){$("#comment_edit textarea").val(),$("#comment_edit_background").hide()}),$("#comment_edit .submit").click(function(){return ajax_session="#comment_edit",ajax_report("#comment_edit"),$.post(gallery_path+"/ajax.php",{anticsrf:anticsrf,section:"edit-comment",edit_md5:$("#co"+com_id+" .comment_edit").attr("id"),id:com_id,message:$("#comment_edit textarea").val(),type:"image"},function(e){if(null!=e)switch(e.status){case"error":$("#comment_edit .message").hide(),alert_error(e.msg);break;case"nochange":$("#comment_edit .message").hide();break;case"success":$("#co"+com_id+" .comment_message").html(e.message),ajax_message_success("#comment_edit");break;case"warning":ajax_message_error("#comment_edit",e.msg)}},"json"),!1})}if($("#map_list").is("div")&&$("span.p a").click(function(){$(this).parent().hasClass("fold")?($(this).parent().children(".p + span + ul").css("display","block"),$(this).parent().removeClass("fold"),$(this).text("[-]")):($(this).parent().children(".p + span + ul").css("display","none"),$(this).parent().addClass("fold"),$(this).text("[+]"))}),$("#watermark_options").is("div")&&($("#watermark_specific").prop("checked")?$("#watermark_options").show():$("#watermark_options").hide(),$("#watermark_none").change(function(){$(this).prop("checked")&&$("#watermark_options").hide()}),$("#watermark_default").change(function(){$(this).prop("checked")&&$("#watermark_options").hide()}),$("#watermark_specific").change(function(){$(this).prop("checked")&&$("#watermark_options").show()}),addEvent(document,"mousedown",function(e){$(".colorpicker_canvas").hide()}),$(".colorpicker").each(function(){var e=$(this).attr("id");$(this).after('<img id="colorpicker_icon_'+e+'" width="16" height="16" alt="" src="'+style_path+'/icons/color-pencil.png" />'),$(this).parent("p").after('<div class="colorpicker_canvas" id="colorpicker_'+e+'"></div>'),$(this).parents("p").find("img").click(function(){$("#colorpicker_"+e).show(),$(this).parent().find("input").focus()}),$("#colorpicker_"+e).farbtastic("#"+e)})),$("#igalerie #worldmap_canvas").is("div")){for(var map_options={center:new google.maps.LatLng(geoloc_center_lat,geoloc_center_long),mapTypeId:google.maps.MapTypeId[geoloc_type],zoom:geoloc_zoom},map=new google.maps.Map(document.getElementById("worldmap_canvas"),map_options),infowindow,create_marker=function(e,t,a,i){var o=new google.maps.Marker({icon:gallery_path+"/images/markers/"+i,position:new google.maps.LatLng(e,t),map:map,shadow:gallery_path+"/images/markers/marker-shadow.png"});google.maps.event.addListener(o,"click",function(){infowindow?infowindow.close():infowindow=new google.maps.InfoWindow,infowindow.setContent(a),infowindow.open(map,o)})},i=0;i<geoloc_images.length;i++)create_marker(geoloc_images[i].latitude,geoloc_images[i].longitude,geoloc_images[i].html,"marker-image.png");for(var i=0;i<geoloc_categories.length;i++)create_marker(geoloc_categories[i].latitude,geoloc_categories[i].longitude,geoloc_categories[i].html,"marker-album.png");$("#worldmap_canvas").delegate(".geoloc_nav a","click",function(){var e=$(this).attr("class").replace("geoloc_",""),t=$(this).parents(".geoloc_bloc").find(".geoloc_"+$(this).attr("data-geoloc-type")).length,a=$(this).parents(".geoloc_bloc").find(".geoloc_"+$(this).attr("data-geoloc-type")+":visible"),i=a.attr("id").replace("geoloc_"+$(this).attr("data-geoloc-type")+"_",""),o="next"==e?parseInt(i)+1:parseInt(i)-1;a.hide(),$(this).parents(".geoloc_bloc").find("#geoloc_"+$(this).attr("data-geoloc-type")+"_"+o).show(),$(this).parents(".geoloc_bloc").find(".geoloc_nav span").text(o+"/"+t),1==i&&$(this).parents(".geoloc_bloc").find(".geoloc_prev").css("visibility","visible"),2==i&&"prev"==e&&$(this).parents(".geoloc_bloc").find(".geoloc_prev").css("visibility","hidden"),parseInt(i)+1==t&&"next"==e&&$(this).parents(".geoloc_bloc").find(".geoloc_next").css("visibility","hidden"),i==t&&$(this).parents(".geoloc_bloc").find(".geoloc_next").css("visibility","visible")})}if($("#gmap_canvas").is("div")){var latlng=new google.maps.LatLng(geoloc_lat,geoloc_long),map_options={center:latlng,mapTypeId:google.maps.MapTypeId[geoloc_type],zoom:10},map=new google.maps.Map(document.getElementById("gmap_canvas"),map_options),marker=new google.maps.Marker({icon:gallery_path+"/images/markers/marker-image.png",position:latlng,map:map,shadow:gallery_path+"/images/markers/marker-shadow.png"});google.maps.event.addListener(marker,"click",function(){map.setCenter(latlng)})}if($("#image_rate").is("div")){var rate_init=[],rate_c=0,rate_i=0;$("#image_rate img").each(function(){rate_init[rate_i]=$(this).attr("src"),$(this).attr("id","rate_"+rate_i).attr("style","cursor:pointer").bind("mouseenter",{id:$(this).attr("id")},rate_over).bind("mouseleave",{id:$(this).attr("id")},rate_out).bind("click",{id:$(this).attr("id")},rate_click),rate_i++})}var anim_speed=0,current_tool="#obj_tool_menu",change_icon=function(){$("#obj_tools_link").removeClass().addClass("obj_tool_menu_icon")},hide_box=function(){clear_menu(),$(".obj_tool_box").hide(anim_speed,change_icon),$("#obj_tools_link a").removeClass("tool_menu_open")},timeout_menu,hide_menu=function(){$("#obj_tool_menu").is(":hidden")||(clear_menu(),timeout_menu=setTimeout(function(){$("#obj_tool_menu").hide(anim_speed),$("#obj_tools_link").hasClass("obj_tool_menu_icon")&&$("#obj_tools_link a").removeClass("tool_menu_open")},500))},clear_menu=function(){clearTimeout(timeout_menu)};$("#obj_tool_menu").bind("mouseenter",clear_menu).bind("mouseleave",hide_menu),$("#obj_tools_link").bind("mouseenter",clear_menu).bind("mouseleave",hide_menu),$("#obj_tools_link").click(function(){clear_menu(),$("#obj_tool_menu").is(":hidden")?$(current_tool).hide(anim_speed,function(){$("#obj_tool_menu").show(anim_speed,change_icon),$("#obj_tools_link a").addClass("tool_menu_open")}):$("#obj_tool_menu").hide(anim_speed,function(){$("#obj_tools_link a").removeClass("tool_menu_open")})}),$("#obj_tool_menu .js_link").removeAttr("href"),$(".obj_tool_title").click(function(){$("#obj_tools_link").trigger("click")}),$(".obj_tool_box .cancel").click(hide_box),$(".obj_tool_box_link").each(function(){$(this).click(function(){current_tool="#obj_"+$(this).attr("id"),$("#obj_tool_menu").hide(anim_speed,function(){$(current_tool).show(anim_speed,function(){$("#obj_tools_link").removeClass().addClass($(this).attr("id")+"_icon"),$(current_tool+" .obj_tool_focus:visible:first").focus()})})})}),$(".obj_tool_box:not(#obj_tool_search) form").submit(function(){return!1}),$("#obj_tools li").click(function(){$(this).find("a").attr("href")&&(window.location=$("#"+$(this).attr("id")+" a").attr("href"))});for(var o=["fav","basket"],i=0;i<o.length;i++)$("#obj_tool_menu li#tool_"+o[i]).click(function(){var type=$(this).attr("id").replace(/tool_/,""),action=$("#tool_"+type+" .icon").hasClass("icon_"+type+"_add")?"-add":"-remove";ajax_session=type,$.post(gallery_path+"/ajax.php",{anticsrf:anticsrf,section:("fav"==type?"favorites":"basket")+action,images_id:img_id,q:q,q_md5:q_md5},function(r){if(null!=r)switch(r.status){case"error":alert_error(r.msg);break;case"full":alert(r.msg);break;case"success":"-add"==action?("fav"==type&&$("#position .current").addClass("favorite"),$("#tool_"+type+" a").text(eval("msg_"+type+"_del")),$("#tool_"+type+" .icon").removeClass("icon_"+type+"_add").addClass("icon_"+type+"_remove")):("fav"==type&&$("#position .current").removeClass("favorite"),$("#tool_"+type+" a").text(eval("msg_"+type+"_add")),$("#tool_"+type+" .icon").removeClass("icon_"+type+"_remove").addClass("icon_"+type+"_add"))}},"json")});if($("#obj_tool_search").is("div")&&$("#tool_search").click(function(){$("#obj_tool_search .text").focus()}),$("#obj_tool_edit").is("div")){$("#edit_langs select").is("select")&&$("#edit_langs select").change(function(){var e=$(this).find(":selected").val();$("#obj_tool_edit label.icon_lang").parents("p").hide(),$("#obj_tool_edit label.icon_"+e).parents("p").show()}),ajax_report("#obj_tool_edit");var edit_data=[];edit_data.title=[],edit_data.desc=[];var edit_title=[],edit_desc=[];$(".edit_desc").each(function(){var e=$(this).attr("name").replace(/(title|desc|\[|\])/g,"");edit_title[e]=$("#edit_title_"+e).val(),edit_desc[e]=$("#edit_desc_"+e).val(),edit_data.title[e]=$("#edit_title_"+e).val(),edit_data.desc[e]=$("#edit_desc_"+e).val()}),$("#obj_tool_edit .submit").click(function(){var e=$("#edit_urlname").val(),t=$("#edit_tags").val();$(".edit_desc").each(function(){var e=$(this).attr("name").replace(/(title|desc|\[|\])/g,"");edit_title[e]=$("#edit_title_"+e).val(),edit_desc[e]=$("#edit_desc_"+e).val()}),ajax_session="#obj_tool_edit",$.post(gallery_path+"/ajax.php",{section:"undefined"!=typeof img_id?"edit-image":"edit-category",id:"undefined"!=typeof img_id?img_id:cat_id,data:$("#obj_tool_edit form").serialize(),urlname:e,tags:t,anticsrf:anticsrf,q:q,q_md5:q_md5},function(t){if(null!=t)switch(t.status){case"nochange":$("#obj_tool_edit .message").hide();break;case"success":if("undefined"!=typeof img_id){if($("#image_description").is("div")&&""==t.desc)$("#image_description").slideUp("slow",function(){$("#image_description").remove(),$("#image_infos").children().is("div")||($("#image_infos").remove(),$("#image_ratecom").removeClass("image_column"))});else if(!$("#image_description").is("div")&&""!=t.desc){var a='<div style="display:none"class="image_column_bloc" id="image_description"><h2>'+text_desc+"</h2><p></p></div>";if($("#image_infos").is("div"))$("#image_tags").is("div")?$("#image_tags").after(a):$("#image_infos").prepend(a);else{var i;$("#image_ratecom").is("div")&&(i=' class="image_column"',$("#image_ratecom").addClass("image_column")),$("#image_container").after("<div"+i+' id="image_infos">'+a+"</div>")}}$("#image_description p").html(t.desc),$("#image_description").slideDown("slow")}else 1!=page||thumbs_cat_extended&&1!=cat_id||($("#cat_description").is("div")&&""==t.desc?$("#cat_description").slideUp("slow",function(){$("#cat_description").remove()}):$("#cat_description").is("div")||""==t.desc||$("#position").after('<div style="display:none" id="cat_description"><p></p></div>'),$("#cat_description p").html(t.desc),$("#cat_description").slideDown("slow"));if(t.title&&$("#position .current a").html(t.title),$("#position .current a").attr("href",$("#position .current a").attr("href").replace(/((?:album|category|image)\/\d+-).+$/,"$1"+e)),"undefined"!=typeof text_tags&&"object"==typeof t.tags){if($("#image_tags").is("div")&&""==t.tags)$("#image_tags").slideUp("slow",function(){$("#image_tags").remove(),$("#image_infos").children().is("div")||($("#image_infos").remove(),$("#image_ratecom").removeClass("image_column"))});else if(!$("#image_tags").is("div")&&""!=t.tags){var o='<div style="display:none"class="image_column_bloc" id="image_tags"><h2>'+text_tags+"</h2><ul></ul></div>";if($("#image_infos").is("div"))$("#image_infos").prepend(o);else{var i;$("#image_ratecom").is("div")&&(i=' class="image_column"',$("#image_ratecom").addClass("image_column")),$("#image_container").after("<div"+i+' id="image_infos">'+o+"</div>")}}if(null!=t.tags){for(var s="",n=0;n<t.tags.length;n++)s+='<li class="icon icon_tag"><a href="'+t.tags[n].tag_link+'">'+t.tags[n].tag_name+"</a></li>\n";$("#image_tags ul").html(s)}$("#image_tags").slideDown("slow")}$(".edit_desc").each(function(){var e=$(this).attr("name").replace(/(title|desc|\[|\])/g,"");"undefined"!=typeof t.desc_langs&&"undefined"!=typeof t.desc_langs[e]&&(edit_data.desc[e]=t.desc_langs[e],$("#edit_desc_"+e).val(t.desc_langs[e])),"undefined"!=typeof t.title_langs&&"undefined"!=typeof t.title_langs[e]&&(edit_data.title[e]=t.title_langs[e],$("#edit_title_"+e).val(t.title_langs[e]))}),ajax_message_success("#obj_tool_edit");break;case"warning":ajax_message_error("#obj_tool_edit",t.msg);break;case"error":$("#obj_tool_edit .message").hide(),alert_error(t.msg)}},"json")}),$("#obj_tool_edit .cancel").click(function(){return $(".edit_desc").each(function(){var e=$(this).attr("name").replace(/(title|desc|\[|\])/g,"");$("#edit_title_"+e).val(edit_data.title[e]),$("#edit_desc_"+e).val(edit_data.desc[e])}),!1})}if($("#obj_tool_menu li#tool_download").click(function(){window.location=download_url}),$("#obj_tool_menu li#tool_basket_empty").click(function(){confirm(confirm_basket_empty)&&($("#obj_tools").after('<form style="display:none" id="basket_empty_form" action="" method="post"><p><input name="anticsrf" type="hidden" value="'+anticsrf+'" /><input name="basket_empty" type="submit" value="1" /></p></form>'),$("#basket_empty_form input").click())}),$("#obj_tool_menu li#tool_delete_image").click(function(){confirm(confirm_delete_image)&&$.post(gallery_path+"/ajax.php",{anticsrf:anticsrf,section:"delete-image",image_id:img_id,q:q,q_md5:q_md5},function(e){if(null!=e)switch(e.status){case"error":alert_error(e.msg);break;case"success":alert(e.msg),window.location=$("#position_special").is("p")?$("#position a").eq(-1).attr("href").replace(/image\/.+/,"")+q.replace(/image\/\d+-[^\/]+\//,""):$("#position a").eq(-2).attr("href")}},"json")}),$("#obj_tool_menu li#tool_update").click(function(){$.post(gallery_path+"/ajax.php",{anticsrf:anticsrf,section:"update-image",image_id:img_id,q:q,q_md5:q_md5},function(e){if(null!=e)switch(e.status){case"error":alert_error(e.msg);break;case"nochange":alert(e.msg);break;case"success":alert(e.msg),location.reload()}},"json")}),$("#tool_thumbs_tools").click(function(){var e=0;$(".thumb_icons").is(":hidden")?($(".thumb_icons").show(),$("#tool_thumbs_tools span").attr("class","icon icon_thumbs_less"),e=1):($(".thumb_icons").hide(),$("#tool_thumbs_tools span").attr("class","icon icon_thumbs_more")),$.post(gallery_path+"/ajax.php",{section:"prefs",cookie_param:"thumb_icons",cookie_value:e})}),$(".thumb_icons").is("span")){for(var icon_active=function(type,e){e.find("img").attr("src",e.find("img").attr("src").replace(/(-active)?.png$/,"-active.png")),e.attr("title",eval("msg_"+type+"_del"))},icon_inactive=function(type,e){e.find("img").attr("src",e.find("img").attr("src").replace(/(-active)?.png$/,".png")),e.attr("title",eval("msg_"+type+"_add"))},o=["fav","basket"],i=0;i<o.length;i++)$(".thumb_icon_"+o[i]).click(function(){var e=$(this),t=e.attr("class").replace(/thumb_icon_/,""),a=e.find("img").attr("src").match(/-active/)?"-remove":"-add";ajax_session=o[i],$.post(gallery_path+"/ajax.php",{anticsrf:anticsrf,section:("fav"==t?"favorites":"basket")+a,images_id:e.parents("dl").attr("id").replace(/img_/,""),q:q,q_md5:q_md5},function(i){if(null!=i)switch(i.status){case"error":alert_error(i.msg);break;case"full":alert(i.msg);break;case"success":"-add"==a?icon_active(t,e):icon_inactive(t,e)}},"json")});if($("#obj_tool_select").is("div")){var selection=[],nb_thumbs=$(".thumbs dl").length;ajax_report("#obj_tool_select"),$('#obj_tool_select form input[type="reset"]').click(),$("#obj_tool_select .submit").prop("disabled",!0),$('#obj_tool_select form input[type="reset"]').click(function(){$("#obj_tool_select #selection_action option:first").prop("selected",!0),$("#obj_tool_select textarea,#obj_tool_select input.text").text()}),$(".thumb_icon_select").click(function(){var e=$(this),t=e.parents("dl").attr("id").replace(/img_/,"");if(-1==$.inArray(t,selection))selection.push(t),icon_active("select",e),e.parents("dl").addClass("select");else{for(var a=0;a<selection.length;a++)selection[a]==t&&selection.splice(a,1);icon_inactive("select",e),e.parents("dl").removeClass("select")}selection.length==nb_thumbs?$("#tool_select_all a").text(msg_select_all_del):$("#tool_select_all a").text(msg_select_all_add);var i=selection.length>1?msg_select_nb_images:msg_select_nb_image;$("#msg_select_nb_images").text(i.replace(/%s/,selection.length)),selection.length>0?$("#obj_tool_select .submit").prop("disabled",!1):$("#obj_tool_select .submit").prop("disabled",!0)}),$("#tool_select_all").click(function(){var e=selection.length;$(".thumbs dl").each(function(){(e==nb_thumbs||e!=nb_thumbs&&!$(this).hasClass("select"))&&$(this).find(".thumb_icon_select").click()})}),$("#obj_tool_select #selection_action").change(function(){$(this).children('option[value="tags_add"]').prop("selected")?($("#tags_add_field").show(),$("#tags_add_field textarea").focus()):$("#tags_add_field").hide(),$(this).children('option[value="tags_remove"]').prop("selected")?($("#tags_remove_field").show(),$("#tags_remove_field textarea").focus()):$("#tags_remove_field").hide()}),$("#obj_tool_select .submit").click(function(){ajax_session="#obj_tool_select";var e={anticsrf:anticsrf,images_id:selection.join(","),q:q,q_md5:q_md5},t=$("#obj_tool_select #selection_action option:selected").val()||$("#obj_tool_select #selection_action option:first").val();switch(t){case"basket_add":e.section="basket-add";break;case"basket_remove":e.section="basket-remove";break;case"download":return void(window.location=gallery_path+"/download.php?sel="+selection.join(","));case"fav_add":e.section="favorites-add";break;case"fav_remove":e.section="favorites-remove";break;case"tags_add":e.section="tags-add",e.tags=$("#tags_add").val();break;case"tags_remove":e.section="tags-remove",e.tags=$("#tags_remove").val();break;default:return}$.post(gallery_path+"/ajax.php",e,function(t){if(null!=t)switch(t.status){case"error":$("#obj_tool_select .ajax_report.message_success").hide(),alert_error(t.msg);break;case"full":$("#obj_tool_select .ajax_report.message_success").hide(),alert(t.msg);break;case"success":switch(ajax_message_success("#obj_tool_select",t.msg),e.section){case"basket-add":case"favorites-add":for(var a=e.section.match(/fav/)?"fav":"basket",i=0;i<selection.length;i++)icon_active(a,$("dl#img_"+selection[i]+" .thumb_icon_"+a));break;case"basket-remove":case"favorites-remove":for(var a=e.section.match(/fav/)?"fav":"basket",i=0;i<selection.length;i++)icon_inactive(a,$("dl#img_"+selection[i]+" .thumb_icon_"+a))}}},"json")})}}if("undefined"!=typeof upload_options){var upload=new Upload("upload_",upload_options),alb_id,select_cat_change=function(){$("#upload_categories select").change(function(){for(var e=$(this).children("option:selected").val(),t=parseInt($(this).attr("id").replace(/upload_categories_/,"")),a=t+1;$("#upload_categories_"+a).is("select");)$("#upload_categories_"+a).remove(),$("#upload_sep_"+a).remove(),a++;"undefined"!=typeof albums_list[e]&&1==albums_list[e].c&&select_cat_create(e,t+1);for(var a=1;$("#upload_categories_"+a).is("select");)a++;a--;var e=$("#upload_categories_"+a+" option:selected").val();if("undefined"!=typeof albums_list[e]&&0==albums_list[e].c){upload.options.ajaxData.id=e.replace(/i(\d+)/,"$1");for(var i=albums_list[e].t,o=albums_list[e].p;"undefined"!=typeof albums_list[o]&&o>1;)i=albums_list[o].t+cat_separator+i,o=albums_list[o].p;$("#select_path").removeClass().addClass("message message_success").html(i)}else upload.options.ajaxData.id=null,$("#select_path").removeClass().addClass("message message_info").html(upload_options.l10n.noAlbum);$('input[name="cat_id"]').val(upload.options.ajaxData.id)})},select_cat_create=function(e,t){e=parseInt(e.toString().replace(/i(\d+)/,"$1"));var a='<select id="upload_categories_'+t+'"><option>---</option>',i=t>1?'<span id="upload_sep_'+t+'">'+cat_separator+"</span>":"";for(var o in albums_list)albums_list[o].p==e&&(a+='<option value="'+o+'">'+albums_list[o].t+"</option>");a+="</select>",$("#upload_categories").append(i+a),select_cat_change()};$(".box form")[0].reset(),select_cat_create(1,1);var autoselect=upload_options.ajaxData.id;if("undefined"!=typeof albums_list["i"+autoselect]){for(var parent_id=albums_list["i"+autoselect].p,parents=[parent_id];"undefined"!=typeof albums_list["i"+parent_id]&&parent_id>1;)parents.push(parent_id),parent_id=albums_list["i"+parent_id].p;for(var n=2,i=parents.length-1;i>0;i--)select_cat_create(parents[i],n),$("#upload_categories_"+(n-1)+' option[value="i'+parents[i]+'"]').prop("selected",!0),n++;$("#upload_categories_"+parents.length+' option[value="i'+autoselect+'"]').prop("selected",!0),$("#upload_categories_"+parents.length).change()}}});